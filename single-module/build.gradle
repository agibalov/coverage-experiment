group 'me.loki2302'
version '1.0-SNAPSHOT'

task wrapper(type: Wrapper) {
  gradleVersion = '4.6'
  distributionUrl = "https://services.gradle.org/distributions/gradle-$gradleVersion-all.zip"
}

apply plugin: 'application'
apply plugin: 'jacoco'

sourceCompatibility = 1.8
mainClassName = 'me.loki2302.App'

repositories {
    mavenCentral()
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.11'

    compile group: 'org.springframework.boot', name: 'spring-boot-starter-web', version: '1.4.1.RELEASE'
    compileOnly group: 'org.projectlombok', name: 'lombok', version: '1.16.20'
}

// jacocoTestReport won't run tests. Either make this dependency, or run as ... test jacocoTestReport
jacocoTestReport.dependsOn test

task jacoco(dependsOn: jacocoTestReport) {}

jacoco {
    toolVersion = "0.8.0"
    applyTo run
}

afterEvaluate {
    jacocoTestReport {
        classDirectories = files(classDirectories.files.collect {
            fileTree(dir: it, exclude: '**/*WillBeExcluded*')
        })
    }
}

run {
    standardInput = System.in
}

task runWithCoverage(type: JacocoReport, dependsOn: 'run') {
    executionData run
    sourceSets sourceSets.main
}
